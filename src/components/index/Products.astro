---
interface Product {
  title: string;
  description: string;
  type: 'CHEATSHEET' | 'E-BOOK' | 'TEMPLATE';
  price: number;
  originalPrice?: number;
  thumbnail?: string;
  link: string;
}

const products: Product[] = [
  {
    title: '[Pre-order] Panduan Kerja Remote',
    description: 'Panduan komprehensif kerja remote: cari kerja, atur work-life balance, hingga produktivitas.',
    type: 'E-BOOK',
    price: 178200,
    originalPrice: 297000,
    thumbnail: 'https://files.utas.io/image/53502cd8829589c59136ae9d8cc45a935e9be.jpg',
    link: 'https://utas.me/ajipratama/panduan-kerja-remote--4r2n5tiy'
  },
  {
    title: 'LandingBook - High performance Landing Page for Ebook',
    description: 'Template landing page cepat, ringan, dan SEO-friendly berbasis Astro untuk produk digital.',
    type: 'TEMPLATE',
    price: 142000,
    originalPrice: 142000,
    thumbnail: 'https://image.utas.co/image/749129f6d207633734b26c0d15986ceb3ac55.jpg',
    link: 'https://utas.me/ajipratama/landingbook---high-performance-landing-page-for-ebook-cela9wzd'
  },
  {
    title: 'Template bio - High performance',
    description: 'Template bio digital cepat dan profesional berbasis Astro untuk personal branding.',
    type: 'TEMPLATE',
    price: 25000,
    originalPrice: 25000,
    thumbnail: 'https://image.utas.co/image/74805dedcbd26d32203336bf83dc0f41b4b80.jpg',
    link: 'https://utas.me/ajipratama/template-bio---high-performance-ti8ipla0'
  },
  {
    title: 'Notion Template Job Hunting Tracker',
    description: 'Template Notion gratis untuk melacak proses cari kerja, perusahaan incaran, dan tipe pekerjaan.',
    type: 'TEMPLATE',
    price: 0,
    originalPrice: 17845,
    thumbnail: 'https://files.utas.io/image/564627e4890b182541574244191eb4386ce57.jpg',
    link: 'https://utas.me/ajipratama/notion-template-job-hunting-tracker-xsqaefys'
  },
  {
    title: 'Kurasi & Roadmap Software Engineer Remote',
    description: 'Panduan roadmap dan kurasi resource untuk software engineer yang ingin kerja remote.',
    type: 'E-BOOK',
    price: 25000,
    originalPrice: 45000,
    thumbnail: 'https://files.utas.io/image/53584c48ca14c57dc1f331e99775f8649314b.jpg',
    link: 'https://utas.me/ajipratama/pre-order-kurasi--roadmap-software-engineer-remote-heanezpy'
  },
  {
    title: '[Pre-order] Personal Management Hacks with Trello',
    description: 'Panduan praktis mengatur tugas dan waktu dengan Trello untuk produktivitas personal.',
    type: 'E-BOOK',
    price: 47000,
    originalPrice: 79000,
    thumbnail: 'https://files.utas.io/image/5358395b688156e1f9376357bf01dfc9b7cf3.jpg',
    link: 'https://utas.me/ajipratama/pre-order-personal-management-hacks-with-trello-hmn30emx'
  }
];

function formatPrice(price: number) {
  return price === 0 ? 'GRATIS' : `IDR ${price.toLocaleString('id-ID')}`;
}

const types = ['ALL', ...new Set(products.map(p => p.type))];
---

<div class="my-10">
  <div class="flex items-center gap-2 mb-4">
    <h2 class="text-xl font-bold">Products</h2>
  </div>

  <div class="flex gap-2 mb-4" id="type-filters">
    {types.map(type => (
      <button
        data-type={type}
        class="px-3 py-1 rounded-full text-sm font-medium transition-colors text-white bg-[#4868e0] hover:bg-[#3a54c4]"
      >
        {type}
      </button>
    ))}
  </div>

  <div class="grid grid-cols-2 gap-3" id="products-grid">
    {products.map((product) => (
      <div 
        class="product-card group flex flex-col h-full glass bg-white/60 backdrop-blur-md rounded-xl border border-gray-200 shadow-sm hover:shadow-lg hover:border-blue-200 transition duration-300 dark:bg-slate-900/60 dark:border-gray-700 overflow-hidden bg-gradient-to-r from-white/80 to-white/40 dark:from-slate-900/80 dark:to-slate-900/40 ring-1 ring-white/50 dark:ring-white/10 shadow-[#4868e0]/10"
        data-type={product.type}
      >
        <div class="relative overflow-hidden">
          {product.thumbnail ? (
            <div class="overflow-hidden">
              <img 
                src={product.thumbnail} 
                alt={product.title} 
                class="w-full h-40 object-cover rounded-t-xl transition-transform duration-500 group-hover:scale-105" 
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/10 to-white/20 opacity-20 group-hover:opacity-40 transition-opacity duration-300"></div> <!-- Efek shiny pada card -->
            </div>
          ) : (
            <div class="w-full h-40 rounded-t-xl flex items-center justify-center bg-gradient-to-r from-blue-50/80 to-indigo-50/80 backdrop-blur-sm dark:from-slate-800/80 dark:to-slate-700/80">
              <span class="text-lg font-bold text-gray-800 dark:text-white px-4 text-center">{product.title}</span>
            </div>
          )}
          <div class="absolute top-3 left-3">
            <span 
              class="inline-flex p-0.5 rounded-full text-[10px] font-medium"
              style={{
                background: product.type === 'E-BOOK' ? 'linear-gradient(to right, #3b82f6, #60a5fa)' : 
                          product.type === 'TEMPLATE' ? 'linear-gradient(to right, #8b5cf6, #a78bfa)' : 
                          'linear-gradient(to right, #10b981, #34d399)',
                color: '#ffffff'
              }}
            >
              {product.type}
            </span>
          </div>
        </div>
        <div class="p-3"> <!-- Padding dikurangi dari p-4 menjadi p-3 -->
          <div class="flex-grow">
            <h3 class="text-base font-bold text-gray-800 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition duration-300">
              {product.title}
            </h3>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400 hidden md:block">
              {product.description}
            </p>
            <div class="mt-2 flex items-center gap-2"> <!-- Margin dikurangi dari mt-3 menjadi mt-2 -->
              {product.originalPrice && product.originalPrice > product.price && (
                <span class="text-sm text-gray-500 line-through dark:text-gray-400">
                  IDR {product.originalPrice.toLocaleString('id-ID')}
                </span>
              )}
              <span class={`inline-flex items-center gap-1.5 py-1 px-2.5 rounded-full text-sm font-semibold
                ${product.price === 0
                  ? 'bg-green-100 text-green-800'
                  : 'bg-[#4868e0] text-black'}`}>
                {product.price === 0 ? 'GRATIS' : `IDR ${product.price.toLocaleString('id-ID')}`}
              </span>
            </div>
          </div>
          <a
            class={`mt-3 py-2 px-3 inline-flex justify-center items-center gap-2 rounded-lg border font-medium
              ${product.price === 0
                ? 'bg-green-600 text-white hover:bg-green-700'
                : '!bg-[#4868e0] !text-white hover:!bg-[#3a54c4] !border-[#4868e0] !opacity-100 !border-solid'}
              shadow-sm align-middle focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-white focus:ring-[#4868e0]
              transition-all text-sm w-full`}
            style={product.price !== 0 ? { backgroundColor: '#4868e0', borderColor: '#4868e0', color: '#fff' } : {}}
            href={product.link}
            target="_blank"
            rel="noopener noreferrer"
          >
            {product.price === 0 ? 'DOWNLOAD' : 'CHECKOUT'}
          </a>
        </div>
      </div>
    ))}
  </div>
</div>

<script is:inline>
  const filterButtons = document.querySelectorAll('#type-filters button');
  const productCards = document.querySelectorAll('.product-card');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      // Remove active class from all buttons
      filterButtons.forEach(btn => {
        btn.classList.remove('bg-blue-600', 'text-white');
        btn.classList.add('bg-gray-100', 'text-gray-600');
      });

      // Add active class to clicked button
      button.classList.add('bg-blue-600', 'text-white');
      button.classList.remove('bg-gray-100', 'text-gray-600');

      const selectedType = button.dataset.type;

      // Filter products
      productCards.forEach(card => {
        if (selectedType === 'ALL' || card.dataset.type === selectedType) {
          card.style.display = '';
        } else {
          card.style.display = 'none';
        }
      });
    });
  });

  // Set ALL as default active filter
  filterButtons[0]?.click();
</script>